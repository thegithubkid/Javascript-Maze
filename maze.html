<!DOCTYPE html>
<html>
	<head>
		<style>
				canvas
				{
					border: 1px solid black;
					background-color: yellow;
				}
				h1
				{
					text-align: left;
				}
		</style>
	</head>
	<body>
		<h1>Four Square</h1>
		<canvas id="Canvas" width="800" height="800">Your browser does not support the HTML5 canvas tag.</canvas>
		<br>
		<script>
			var canvas = document.getElementById("Canvas");
			var ctx = canvas.getContext("2d");
			var x_origin = 50;
			var radius = 50;
			var y_origin = (canvas.height - radius);
			var moveMade = false;
			var size = 8;
			
			//create a new 2d array and pass it to grid
			var grid = createBoard();
			
			//call the draw board function to display the grid
			//requires a 2d array in order to draw
			drawBoard(grid);
			
			//event to check if the mouse is clicked within canvas boundaries
			//also calls the draw function to update
			canvas.addEventListener("click", mouseClick);
			
			//fuction to draw the board/grid from a 2d array
			//draws the circles based on the array index length
			//but colors the circles from the contents of the 2d array
			function drawBoard(g)
			{
				for(var i = 0; i < g.length; i++)
				{
					var x_axis = x_origin + 100*i;
					
					for(var j = 0; j < g[i].length; j++)
					{
						var y_axis = y_origin - 100*j;
						
						ctx.beginPath();
						ctx.arc(x_axis,y_axis,radius,0,2*Math.PI);
						ctx.fillStyle = g[i][j];
						ctx.stroke();
						ctx.fill();
					}
				}
			}
			//function that detects mouse click and where it was clicked
			//colors a circle depending where the mouse is clicked on the canvas
			function mouseClick(event)
			{
				var x = event.x;
				
				x -= canvas.offsetLeft;
				x = parseInt(x / (radius * 2));	//convert x coordinate to column number
				
				//color the bottom-most circle on the grid
				//depending on the column clicked on
				for(var i = 0; i < grid[x].length; i++)
				{
					if(grid[x][i] == "white")
					{
						moveMade = true;
						grid[x][i] = "red";
						drawBoard(grid);
						break;
					}
				}
				
				if (moveMade == true) {
					smartComputerPlayer();
				}
				
			}
			//creates a 2d array that contains a string of "color" elements
			//the 2d array contains blank "white" elements
			function createBoard()
			{
				var board = new Array(8);
				
				for(var i = 0; i < board.length; i++)
				{
					board[i] = new Array("white","white","white","white","white","white","white","white");
				}
				return board;
			}

			function computerPlayer(){
				var x = Math.floor((Math.random() * 7) + 1);
				console.log (x);
				for(var i = 0; i < grid[x].length; i++)
				{
					if(grid[x][i] == "white")
					{
						grid[x][i] = "blue";
						break;
					}
				}
				drawBoard(grid);
				moveMade = false;
			}
/*
smart computer player only plays offence by searching all postions near by with its color
it is weighted then picked the highest weight.
*/
			function smartComputerPlayer(){
				moveMade = false;
				var weightArr = [];

				loop1 :for(var i = 0; i < size; i++){
					var arr = 0;
					for(var j = 0; j < size; j++){
						if (grid[i][j] == "white"){
							arr += checkLeft(i,j);
							arr += checkDown(i,j);
							arr += checkRight(i,j);
							arr += leftDown(i,j);
							arr += rightDown(i,j);
							
						}
					}
					console.log("arr " + arr + "row " + i);
					weightArr.push(arr);
				}
				var x = weightArr.indexOf(Math.max.apply(Math, weightArr));
				console.log( x);
				if (x == 0){
					x = Math.floor((Math.random() * 7) + 1);
				}
				for(var i = 0; i < size; i++)
				{
					if(grid[x][i] == "white")
					{
						grid[x][i] = "blue";
						break;
					}
				}
				drawBoard(grid);
			}

			function checkLeft(x,y){
				var offset = 3;
				var weight = 0;
				if (x == 2){
					offset = 2
				}else if (x == 1){
					offset = 1;
				}else if (x == 0){
					offset = 0;
				}
				
				for(var i = 1; i <= offset; i++){
					if (grid[x - i][y] == "blue"){
						weight += 1;
					}
				}
				return weight;
			}

			function leftDown(x,y){
				var offset = 3;
				var weight = 0;
				if (x == 2){
					offset = 2
				}else if (x == 1){
					offset = 1;
				}else if (x == 0){
					offset = 0;
				}else if (y == 2){
					offset = 2
				}else if (y == 1){
					offset = 1;
				}else if (y == 0){
					offset = 0;
				}

				for(var i = 1; i <= offset; i++){
					if (grid[x - i][y - i] == "blue"){
						weight += 1;
					}
				}
				return weight;
			}

			function checkDown(x,y){
				var offset = 3;
				var weight = 0;
				if (y == 2){
					offset = 2
				}else if (y == 1){
					offset = 1;
				}else if (y == 0){
					offset = 0;
				}
				
				for(var i = 1; i <= offset; i++){
					if (grid[x][y - i] == "blue"){
						weight += 1;
					}
				}
				return weight;
			}

			function rightDown(x,y){
				var offset = 3;
				var weight = 0;
				if (x == 5){
					offset = 2
				}else if (x == 6){
					offset = 1;
				}else if (x == 7){
					offset = 0;
				}else if (y == 2){
					offset = 2
				}else if (y == 1){
					offset = 1;
				}else if (y == 0){
					offset = 0;
				}
				for(var i = 1; i <= offset; i++){
					if (grid[x + i][y + i] == "blue"){
						weight += 1;
					}
				}
				return weight;
			}

			function checkRight(x,y){
				var offset = 3;
				var weight = 0;
				if (x == 5){
					offset = 2
				}else if (x == 6){
					offset = 1;
				}else if (x == 7){
					offset = 0;
				}
				
				for(var i = 1; i <= offset; i++){
					if (grid[x + i][y] == "blue"){
						weight += 1;
					}
				}
				return weight;
			}

		</script> 
	</body>
</html>
